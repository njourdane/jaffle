# "Caverave"
# @license CC BY-NC-SA 4.0 https://creativecommons.org/licenses/by-nc-sa/4.0/
# @by Felix Roos

$Keys:
  Set:
  s: sawtooth
  cutoff: 1200
  gain: .5
  attack: 0
  decay: .16
  sustain: .3
  release: .1

$Drums:
  Stack:
  - S: bd*2
    mask: <x@7 ~>/8
    gain: .8
  - S: ~ <sd!7 [sd@3 ~]>
    mask: <x@7 ~>/4
    gain: .5
  - S: /[~ hh]*2
    delay: .3
    delayfeedback: .5
    delaytime: .125
    gain: .4

$Thru:
  Set:
  transpose: <0 1>/8
  transpose': -1

$Synths:
  Stack:
  - M: <eb4 d4 c4 b3>/2
    scale:
      timeCat^: [ [ 3, C minor ], [ 1, C melodic minor ] ]
      slow: 8
    struct: /[~ x]*2
    layer:
    - { Set: , scaleTranspose: 0, early: 0 }
    - { Set: , scaleTranspose: 2, early: =1/8 }
    - { Set: , scaleTranspose: 7, early: =1/4 }
    - { Set: , scaleTranspose: 8, early: =3/8 }
    apply: $Thru:
    note:
    apply: $Keys:
    mask: <~ x>/16
    color: :darkseagreen

  - Note: <C2 Bb1 Ab1 [G1 [G2 G1]]>/2
    apply: $Thru:
    struct:
      M: /[x [~ x] <[~ [~ x]]!3 [x x]>@2]/2
      fast: 2
    s: sawtooth
    attack: 0.001
    decay: 0.2
    sustain: 1
    cutoff: 500
    color: :brown

  - M: <Cm7 Bb7 Fm7 G7b13>/2
    struct:
      M: ~ [x@0.2 ~]
      fast: 2
    voicings: :lefthand
    apply: $Thru:
    every: [ 2, early: =1/8 ]
    note:
    apply: $Keys:
    sustain: 0
    delay: .4
    delaytime: .12
    mask: <x@7 ~>/8
    early: =1/4

Stack:
- $Drums:
  fast: 2
  color: :tomato
- $Synths:
slow: 2
pianoroll^: { fold: 1 }
